<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <title>开始点名</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/back.css">
    <link rel="stylesheet" href="css/loginDialog.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/laydate2.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/iconfont.js"></script>
    <script src="js/tan.js"></script>
    <script src="js/startSign.js"></script>
    <script type="text/javascript">
    
      	/* var ws;
        var target ="ws://localhost:8080/vein-tech/websocket?corId="+corId;
        function webSocketConnect() {
            if ('WebSocket' in window) {
                ws = new WebSocket(target);
            } else if ('MozWebSocket' in window) {
                ws = new MozWebSocket(target);
            } else {
                alert('WebSocket is not supported by this browser.');
                return;
            }
            
            
            ws.onmessage = function(event){
                var uId = event.data;
                changeSignStatus(uId);
            }
        }
        function subSend(){
            var msg = document.getElementById("msg").value;
            ws.send(msg);
            document.getElementById("msg").value="";
        }
        
        window.onunload = function() {
            ws.close();
        }  */
</script>
</head>
<body>
<!------------------------------全部---------------------------->

<div>
    <div class="left pull-left">
        <h2 id="coporationicon" style="color: #fff; padding-left:45px; font-family:'汉仪菱心体简'; margin-top: 105px;"></h2>
        <!--导航兰-->
        <div class="navs">
            <ul class="nacs">
                <a href="departmentManage.html"> <li><span class="iconfont icon-renyuan"></span>部门管理</li></a>
                <a href="userManage.html"> <li><span class="iconfont icon-yonghu"></span>用户管理</li></a>
                <a href="deviceStatus.html"><li><span class="iconfont icon-shebei"></span>设备管理</li></a>
                <a href="veinCollent.html"><li><span class="iconfont icon-caijirenwu"></span>人员采集</li></a>
                <a href="userList.html"><li  class="one"><span class="iconfont icon-xiangqing"></span>点名</li></a>
                <a href="meetingManage.html"><li><span class="iconfont icon-xiangqing"></span>会议管理</li></a>
                <a href="signWall.html"><li><span class="iconfont icon-xiangqing"></span>照片墙</li></a>
            </ul>
        </div>
    </div>
    <!-----------------------左边部分结束----------------------------->

    <!--------------------页面的右边部分开始--------------->
    <div class="right pull-right contt">
        <!-------右边的头部-------->
        <div class="right-hande">
            <!--------------头部的应用-------------->


        </div>

        <!--设备状态-->
        <div class="row" style=" margin-top:65px; margin-right: 0">
            <div class="col-md-6">

                <span>未到人数：<span style="font-size: 24px; font-weight: bold; color: green" id="notSigned">0</span>人</span>


                <a href="userList.html"><button type="button" class="btn btn-danger" style="margin-left: 15px;">结束点名</button></a>


                <div class="col-md-12" style="border: 1px solid #ccc;  height:700px;padding: 10px;  overflow-y:auto;">
                    <table class="table table-bordered table-striped table-hover">
                        <tbody id="leftTable">
                            <tr>
                                <th>用户ID</th>
                                <th>用户姓名</th>
                                <th>所属部门</th>
                                <th>模板数</th>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-6">

                <span>已到人数：<span style="font-size: 24px; font-weight: bold; color: red" id="signedUser">0</span>人</span>


                <a id="nowDay" href="">
                    <button type="button" class="btn btn-success" style="margin-left: 15px;">生成当天报表</button>
                </a>
                <button type="button" class="btn btn-primary chakan3">
                   	生成历史报表
                </button>
<!--选择日期弹出框-->



                <div class="col-md-12" style="border: 1px solid #ccc;  height:700px;padding: 10px;   overflow-y:auto">
                    <table class="table table-bordered table-striped table-hover">
                        <tbody id="rightTable">
                            <tr>
                                <th>用户ID</th>
                                <th>用户姓名</th>
                                <th>所属部门</th>
                                <th>模板数</th>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <div  class="tan3">
            <div class="modal-dialog" role="document" >
                    <!--头像的位置-->
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="exampleModalLabel">历史报表时间选择</h4>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="demo" class="control-label">选择日期:</label>
                                        <div class="demo1">
                                            <input class="laydate-icon form-control" id="demo" value="2018-1-1" style="height: 35px;">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="sblx" class="control-label">选择开始时间:</label>
                                        <select class="form-control" id="sblx" onchange="selectChange();">
                                            <option value="0">00:00:00</option>
                                            <option value="1">00:30:00</option>
                                            <option value="2">01:00:00</option>
                                            <option value="3">01:30:00</option>
                                            <option value="4">02:00:00</option>
                                            <option value="5">02:30:00</option>
                                            <option value="6">03:00:00</option>
                                            <option value="7">03:30:00</option>
                                            <option value="8">04:00:00</option>
                                            <option value="9">04:30:00</option>
                                            <option value="10">05:00:00</option>
                                            <option value="11">05:30:00</option>
                                            <option value="12">06:00:00</option>
                                            <option value="13">06:30:00</option>
                                            <option value="14">07:00:00</option>
                                            <option vaule="15">07:30:00</option>
                                            <option value="16">08:00:00</option>
                                            <option value="17">08:30:00</option>
                                            <option value="18">09:00:00</option>
                                            <option value="19">09:30:00</option>
                                            <option value="20">10:00:00</option>
                                            <option value="21">10:30:00</option>
                                            <option value="22">11:00:00</option>
                                            <option value="23">11:30:00</option>
                                            <option value="24">12:00:00</option>
                                            <option value="25">12:30:00</option>
                                           	<option value="26">13:00:00</option>
                                           	<option value="27">13:30:00</option>
                                           	<option value="28">14:00:00</option>
                                           	<option value="29">14:30:00</option>
                                           	<option value="30">15:00:00</option>
                                           	<option value="31">15:30:00</option>
                                           	<option value="32">16:00:00</option>
                                           	<option value="33">16:30:00</option>
                                           	<option value="34">17:00:00</option>
                                           	<option value="35">17:30:00</option>
                                           	<option value="36">18:00:00</option>
                                           	<option value="37">18:30:00</option>
                                           	<option value="38">19:00:00</option>
                                           	<option value="39">19:30:00</option>
                                           	<option value="40">20:00:00</option>
                                           	<option value="41">20:30:00</option>
                                           	<option value="42">21:00:00</option>
                                           	<option value="43">21:30:00</option>
                                           	<option value="44">22:00:00</option>
                                           	<option value="45">22:30:00</option>
                                           	<option value="46">23:00:00</option>
                                           	<option value="47">23:30:00</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="sblx2" class="control-label">选择结束时间:</label>
                                        <select class="form-control" id="sblx2" >
                                            <option value="0">00:30:00</option>
                                            <option value="1">01:00:00</option>
                                            <option value="2">01:30:00</option>
                                            <option value="3">02:00:00</option>
                                            <option value="4">02:30:00</option>
                                            <option value="5">03:00:00</option>
                                            <option value="6">03:30:00</option>
                                            <option value="7">04:00:00</option>
                                            <option value="8">04:30:00</option>
                                            <option value="9">05:00:00</option>
                                            <option value="10">05:30:00</option>
                                            <option value="11">06:00:00</option>
                                            <option value="12">06:30:00</option>
                                            <option value="13">07:00:00</option>
                                            <option value="14">07:30:00</option>
                                            <option value="15">08:00:00</option>
                                            <option value="16">08:30:00</option>
                                            <option value="17">09:00:00</option>
                                            <option value="18">09:30:00</option>
                                            <option value="19">10:00:00</option>
                                            <option value="20">10:30:00</option>
                                            <option value="21">11:00:00</option>
                                            <option value="22">11:30:00</option>
                                            <option value="23">12:00:00</option>
                                            <option value="24">12:30:00</option>
                                           	<option value="25">13:00:00</option>
                                           	<option value="26">13:30:00</option>
                                           	<option value="27">14:00:00</option>
                                           	<option value="28">14:30:00</option>
                                           	<option value="29">15:00:00</option>
                                           	<option value="30">15:30:00</option>
                                           	<option value="31">16:00:00</option>
                                           	<option value="32">16:30:00</option>
                                           	<option value="33">17:00:00</option>
                                           	<option value="34">17:30:00</option>
                                           	<option value="35">18:00:00</option>
                                           	<option value="36">18:30:00</option>
                                           	<option value="37">19:00:00</option>
                                           	<option value="38">19:30:00</option>
                                           	<option value="39">20:00:00</option>
                                           	<option value="40">20:30:00</option>
                                           	<option value="41">21:00:00</option>
                                           	<option value="42">21:30:00</option>
                                           	<option value="43">22:00:00</option>
                                           	<option value="44">22:30:00</option>
                                           	<option value="45">23:00:00</option>
                                           	<option value="46">23:30:00</option>
                                           	<option value="47">24:00:00</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                            <span style="color:red;padding-right:80px;display: none" id="promptMessage">结束时间不能小于开始时间</span>	
                                <button type="button" class="btn btn-default guan" data-dismiss="modal">关闭</button>
                                <button type="button" class="btn btn-primary" onclick="historyReport();">确认</button>
                            </div>
                        </div>
                    </div>

            </div>
        </div>
        <!--修改密码的弹出层-->
        <!------------------------右边部分结束------------------------------->
    </div>
</div>
</body>
<script type="text/javascript">
	$(function(){
		var deptId = GetQueryString("deptId");
		$('#nowDay').attr('href','report/currentReport?deptId='+deptId);
		sessionStorage.setItem("deptId", deptId);
		//设置当前日期
		var nowDate = formatDate();
		$('#demo').val(nowDate);
	});
	
    !function(){
        laydate.skin('molv');//切换皮肤，请查看skins下面皮肤库
        laydate({elem: '#demo'});//绑定元素
    }();

    //日期范围限制
    var start = {
        elem: '#start',
        format: 'YYYY-MM-DD',
        min: laydate.now(), //设定最小日期为当前日期
        max: '2099-06-16', //最大日期
        istime: true,
        istoday: false,
        choose: function(datas){
            end.min = datas; //开始日选好后，重置结束日的最小日期
            end.start = datas //将结束日的初始值设定为开始日
        }
    };
    
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
    
    function   formatDate()   {
    	var now = new Date();
        var   year=now.getFullYear();   
        var   month=(now.getMonth()+1)<10?"0"+(now.getMonth()+1):(now.getMonth()+1);    
        var   date=now.getDate();
        return   year+"-"+month+"-"+date;  
    }     
	
    
    function historyReport(){
    	var firstDate = $('#demo').val();
    	var secondDate = $('#sblx option:selected').text();
    	var thirdDate = $('#sblx2 option:selected').text();
    	if(thirdDate=="24:00:00"){
    		thirdDate="23:59:59";
    	}
    	var time1 = firstDate+" "+secondDate;
    	var time2 =  firstDate+" "+thirdDate;
    	var date1 = new Date(time1);
    	var date2 = new Date(time2);
    	var deptId = sessionStorage.getItem("deptId");
    	if(date2.getTime()<date1.getTime()){
    		$('#promptMessage').text("开始时间不能大于结束时间！");
    		$('#promptMessage').show();
    	}else{
    		try {
    			var path = "report/historyreport?startTime="+time1+"&endTime="+time2+"&deptId="+deptId;
        		location.href=path;
        		$('.tan3').hide();
        		$('#promptMessage').hide();
			} catch (e) {
				$('#promptMessage').text("下载报表失败！！");
			}
    	}
    }
</script>
</html>